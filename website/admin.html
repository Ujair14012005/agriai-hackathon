<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Krishi Sahayak</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white">
  <div class="container">
    <a class="navbar-brand" href="index.html">ðŸŒ± Krishi Sahayak - Admin</a>
  </div>
</nav>

<div class="container" style="margin-top:30px;">
  <h3>Admin / Weather</h3>
  <p class="text-muted">Fetch weather for the stored farmer location and view recent escalations/feedback/chat history.</p>

  <div class="mb-3">
    <button id="weatherBtn" class="btn btn-primary">Fetch Weather</button>
    <button id="escalationsBtn" class="btn btn-outline-secondary ms-2">Show Escalations</button>
    <button id="feedbackBtn" class="btn btn-outline-secondary ms-2">Show Feedback</button>
    <button id="historyBtn" class="btn btn-outline-secondary ms-2">Show Chat History</button>
  </div>

  <div id="outArea"></div>
</div>

<script>
  const out = document.getElementById('outArea');
  const fctx = JSON.parse(localStorage.getItem('farmerContext') || '{}');

  document.getElementById('weatherBtn').addEventListener('click', async ()=>{
    out.innerHTML = 'Loading...';
    try {
      const resp = await fetch('/weather?location=' + encodeURIComponent(fctx.location || 'India'));
      const js = await resp.json();
      out.innerHTML = '<pre>' + JSON.stringify(js, null, 2) + '</pre>';
    } catch (e) { out.innerText = 'Failed: '+e }
  });

  document.getElementById('escalationsBtn').addEventListener('click', async ()=>{
    out.innerHTML = 'Loading...';
    try {
      const resp = await fetch('/escalations');
      const js = await resp.json();
      out.innerHTML = '<pre>' + JSON.stringify(js, null, 2) + '</pre>';
    } catch (e) { out.innerText = 'Failed: '+e }
  });

  document.getElementById('feedbackBtn').addEventListener('click', async ()=>{
    out.innerHTML = 'Loading...';
    try {
      const resp = await fetch('/feedback');
      const js = await resp.json();
      out.innerHTML = '<pre>' + JSON.stringify(js, null, 2) + '</pre>';
    } catch (e) { out.innerText = 'Failed: '+e }
  });

  document.getElementById('historyBtn').addEventListener('click', async ()=>{
    out.innerHTML = 'Loading...';
    try {
      const resp = await fetch('/history');
      const js = await resp.json();
      out.innerHTML = '<pre>' + JSON.stringify(js, null, 2) + '</pre>';
    } catch (e) { out.innerText = 'Failed: '+e }
  });
</script>
</body>
</html>