KissanConnect — Streamlit app

This README explains how to set up and run the Streamlit-based app (`app.py`) in this repository.

## What this app does
- Interactive multimodal agricultural advisory prototype.
- Accepts text (Malayalam/English), voice (recorded in-browser), and an image of a leaf/plant.
- Uses local KB (`kb/*.txt`) + sentence-transformer embeddings for retrieval, Google Gemini for generation, and Whisper for speech-to-text.

## Prerequisites
- Windows PowerShell (instructions below use PowerShell syntax).
- Python 3.8+ (recommended). A virtual environment is strongly recommended.
- A copy of this repository (you already have it).

## Important files
- `app.py` — Streamlit app (main entrypoint).
- `requirements.txt` — Python dependencies for the Streamlit app.
- `kb/` — knowledge base text files (one passage per `.txt`).
- `output/uploads/` — saved uploaded images (created at runtime).

## Recommended environment variables
Set these on the server or your PowerShell session before running if you plan to use corresponding features:

- `GEMINI_API_KEY` — API key for Google Gemini (required for LLM generation).
- `OPENWEATHER_API_KEY` — (optional) OpenWeatherMap key for weather checks.
- `TWILIO_SID`, `TWILIO_TOKEN`, `TWILIO_FROM` — (optional) Twilio credentials for SMS.

Example (PowerShell):

```powershell
# temporary for current PowerShell session
$env:GEMINI_API_KEY = 'your_gemini_key_here'
$env:OPENWEATHER_API_KEY = 'your_openweather_key'
$env:TWILIO_SID = 'ACxxxx'
$env:TWILIO_TOKEN = 'xxxxxxxx'
$env:TWILIO_FROM = '+1234567890'
```

## Install dependencies
Open PowerShell in the repository root and run:

```powershell
# (optional) create and activate a virtual env
python -m venv .venv; .\.venv\Scripts\Activate.ps1

# install dependencies
pip install --upgrade pip
pip install -r requirements.txt
```

Notes:
- If you only plan to run the Flask site (`website/app_server.py`), see `website/requirements.txt` for its deps.
- Large ML packages (transformers, torch, sentence-transformers) can take time and space.

## Run the Streamlit app
In PowerShell (after dependencies and env vars are set):

```powershell
# run Streamlit app
streamlit run app.py
```

Streamlit will open a browser tab (or provide a local URL) where you can interact with the UI.

## Quick usage guide (UI)
- Sidebar: set farmer context (Name, Phone, Location, Crop).
- Main panel:
  - Type a question (Malayalam or English).
  - Optionally record voice (in-browser) — the app uses Whisper to transcribe.
  - Optionally upload an image — the app encodes and sends it to Gemini for analysis.
  - Click "Get Advice" to retrieve KB passages and generate an answer.
- Admin panel (right column): view recent escalations and feedback (CSV files in `output/`).

## Where the data is stored
- `output/escalations.csv` — escalations saved via UI.
- `output/feedback.csv` — feedback saved via UI.
- `output/uploads/` — uploaded images.

## Troubleshooting
- If the embedding model fails to load, the app falls back to TF-IDF (scikit-learn).
- Common errors:
  - Missing API key: the UI will indicate which external keys are not configured.
  - Heavy RAM/CPU: loading transformer models may require significant memory. Consider using smaller models or running on a machine with more RAM.

## Security & production notes
- Do NOT commit API keys to source control. Use environment variables or a secure secrets manager.
- For production:
  - Move uploads to S3 or another storage service.
  - Use a managed deployment and secure server-side env vars.
  - Protect admin endpoints and avoid hardcoded API keys (there is a test key in `website/app_server.py` — remove it).

## Contact / next steps
- To add more KB content: add `.txt` files to the `kb/` directory; the app will read them and build embeddings.
- To enable faster vector search in production, consider configuring FAISS or a managed vector DB.

---
Generated by repository tooling to help run `app.py` locally.
